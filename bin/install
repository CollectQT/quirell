#!/bin/bash

# configs
cp -n .env-example .env

# basics
sudo apt-get install -y -qq git curl

# python3.4, pip, virtualenv
if ! command -v python3.4
then
    sudo add-apt-repository -y -qq ppa:fkrull/deadsnakes
    sudo apt-get update
fi
sudo apt-get install -y -qq python3.4 python3.4-dev python-dev\
    python-pip python-virtualenv
virtualenv -p python3.4 venv
source venv/bin/activate
pip install -qr requirements.txt

# ruby
if ! command -v rvm
then
	sudo add-apt-repository -y ppa:rael-gc/rvm
    sudo apt-get update
fi
sudo apt-get install rvm
source /usr/share/rvm/scripts/rvm 
rvm install 2.2
rvm use 2.2
gem install bundler
bundler install

# redis
if ! command -v redis-server
then
	sudo add-apt-repository -y ppa:chris-lea/redis-server
    sudo apt-get update
    sudo apt-get install -y -qq redis-server
fi
redis-server
redis-cli ping

# neo4j
if ! command -v /usr/local/neo4j/bin/neo4j
then
	wget -O - 'http://debian.neo4j.org/neotechnology.gpg.key' | sudo apt-key add -
	sudo add-apt-repository 'deb http://debian.neo4j.org/repo stable/'
	sudo apt-get install -y -qq openjdk-7-jre neo4j
    neoauth neo4j neo4j quirell-password
    neoauth neo4j quirell-password
fi
neo4j-service start
